# Template Edge Processor Example
# 
# This workflow demonstrates the template edge processor for transforming
# edge payloads using Jinja2 templates.

vars:
  API_KEY: ${API_KEY}
  BASE_URL: ${BASE_URL}

nodes:
  - id: DataSource
    type: agent
    name: Data Generator
    description: Generates sample JSON data
    config:
      role: |
        Generate a JSON object with patient information.
        Output format:
        {
          "name": "John Doe",
          "age": 45,
          "diagnosis": "Influenza",
          "severity": "Medium"
        }
      provider: openai
      name: gpt-4
      api_key: ${API_KEY}
      base_url: ${BASE_URL}

  - id: TemplateFormatter
    type: agent
    name: Report Formatter
    description: Formats the report using the template
    config:
      role: |
        You received formatted patient data. Simply output it as-is.
      provider: openai
      name: gpt-4
      api_key: ${API_KEY}
      base_url: ${BASE_URL}

edges:
  # Example 1: Basic variable substitution
  - from: DataSource
    to: TemplateFormatter
    processor:
      type: template
      config:
        template: |
          # Patient Report
          
          **Patient Name:** {{ (input | fromjson).name }}
          **Age:** {{ (input | fromjson).age }}
          **Diagnosis:** {{ (input | fromjson).diagnosis }}
          **Severity:** {{ (input | fromjson).severity }}
          
          {% set data = input | fromjson %}
          {% if data.severity == "High" %}
          ⚠️ URGENT: This case requires immediate attention.
          {% elif data.severity == "Medium" %}
          ℹ️ This case should be reviewed within 24 hours.
          {% else %}
          ✓ This case is low priority.
          {% endif %}

# Template Features Demonstrated:
# 
# 1. JSON Parsing with fromjson filter:
#    {% set data = input | fromjson %}
#
# 2. Variable Access:
#    {{ data.name }}
#
# 3. Conditional Logic:
#    {% if data.severity == "High" %}...{% endif %}
#
# 4. Default Values:
#    {{ data.field | default('N/A') }}
#
# 5. For Loops:
#    {% for item in data.items %}{{ item }}{% endfor %}
#
# Available Context Variables:
# - input: The edge payload content
# - environment: Global environment state
# - extracted: Value from prior processor (regex, etc.)
